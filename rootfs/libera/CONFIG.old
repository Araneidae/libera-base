# Definitions for Libera rootfs.

ROOTFS_VERSION = DLS development 0.00

CONSOLE_BAUD = 115200
CONSOLE_TTY = ttyS0

ROOT_PASSWORD = Jungle

SSH_AUTHORIZED_KEYS = $(configdir)/authorized_keys

CFLAGS = -O2 -mthumb
CFLAGS_dropbear = -O2

TERMS = xterm xterm-color screen vt100 vt102


# This one is essential, nothing boots without it.
EXTRAS += busybox
# Components required for normal operation.
EXTRAS += ntp dropbear portmap
# Useful debugging tools
EXTRAS += strace lsof
# tcpdump
EXTRAS += libpcap tcpdump


# Ask the kernel build for the proper release name.
LINUX_VERSION = $(shell \
    make -s -C $(KERNEL_BUILD) TARGET=libera-2.6 kernelrelease)
    
LIB_MODULES = $(sysroot)/lib/modules/$(LINUX_VERSION)


final-install::
        # Install the regular nfs mounts.
	mkdir -p $(patsubst %,$(sysroot)/mnt/%,nfs prod work)
	cat $(configdir)/fstab >>$(sysroot)/etc/fstab

        # Temporary hacks
	mkdir -p $(LIB_MODULES)
	cp $(LIBERA_ROOT)/libera/libera.ko $(LIBERA_ROOT)/msp/msp.ko \
            $(LIB_MODULES)
	echo /lib/modules/$(LINUX_VERSION)/libera.ko: \
            >>$(LIB_MODULES)/modules.dep
	echo /lib/modules/$(LINUX_VERSION)/msp.ko: \
            >>$(LIB_MODULES)/modules.dep

	$(install-files) $(TOP)/libera/file-list


ifdef DEVELOPMENT
# BOOT = nfs
BOOT = initramfs
include $(configdir)/DEVELOPMENT_$(BOOT)
endif
