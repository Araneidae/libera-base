# Site specific default definitions for upgrade-libera script

# Figure out the right TFTP server by inspecting the broadcast address.
BROADCAST="$(
    ifconfig eth0 |
    sed -nr '/^eth0/{n; s/.*Bcast:([^ ]*) .*/\1/;p;q;}')"
case "$BROADCAST" in
    172.23.255.255)     # Lab address
        TFTP_PREFIX=
        TFTP_SERVER=172.23.240.3 ;;
    172.23.207.255)     # Primary network
        TFTP_PREFIX=export/libera/
        TFTP_SERVER=172.23.194.1 ;;
    *)  echo >&2 Unrecognised broadcast address "$BROADCAST"
        echo >&2 You will need to specify the TFTP server.
        TFTP_SERVER=unknown
        ;;
esac


# Post installation script
POST_SCRIPT='libera-post-install-@@LIBERA_BASE_VERSION@@.tgz'

pre_upgrade()
{
    if [ -e /opt/state/$(hostname).state ]; then
        cp /opt/state/$(hostname).state /mnt/nfs/state/  ||
            Error 'Unable to save state file'
    fi

    # This needs to match base/post-install/post-install.sh
    [ "$SCRIPT_ARGS" = SR -o "$SCRIPT_ARGS" = BO ]  ||
        Error Invalid script argument: must be SR or BO
}
